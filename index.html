<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHEMIE mit KI ‚Äì Linkhub</title>
  <meta name="description" content="Kachel√ºbersicht zu KI-Ressourcen (Padlets, Tools, Quellen) f√ºr MINT / Chemieunterricht." />
  <style>
    :root{
      --bg:#0b1220; --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.55); --line:rgba(255,255,255,.12);
      --radius:18px; --shadow:0 10px 35px rgba(0,0,0,.35); --max:1200px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1100px 600px at 10% -10%, rgba(125,211,252,.22), transparent 60%),
                  radial-gradient(900px 500px at 110% 0%, rgba(167,243,208,.16), transparent 55%),
                  radial-gradient(800px 600px at 50% 110%, rgba(251,191,36,.10), transparent 60%),
                  var(--bg);
      color:var(--text); font-family:var(--font); line-height:1.35;
    }
    a{color:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:26px 16px 60px;}
    header{display:flex; flex-wrap:wrap; gap:16px; align-items:flex-end; justify-content:space-between; margin-bottom:18px;}
    .brand{display:flex; flex-direction:column; gap:6px;}
    .title{font-size:clamp(22px,3.1vw,34px); letter-spacing:.2px; font-weight:760; display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .badge{font-size:12px; padding:4px 10px; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.05); color:var(--muted);}
    .subtitle{color:var(--muted); max-width:78ch; font-size:14px;}
    .top-actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}
    .btn{border:1px solid var(--line); background:rgba(255,255,255,.06); color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:650; display:inline-flex; gap:10px; align-items:center;}
    .btn:hover{background:rgba(255,255,255,.09); border-color:rgba(255,255,255,.2)}
    .btn.primary{background:linear-gradient(135deg, rgba(125,211,252,.20), rgba(167,243,208,.14)); border-color:rgba(125,211,252,.28);} 
    .btn.tools{background:linear-gradient(135deg, rgba(251,191,36,.22), rgba(125,211,252,.10)); border-color:rgba(251,191,36,.38);} 
    .btn.tools:hover{background:linear-gradient(135deg, rgba(251,191,36,.28), rgba(125,211,252,.14)); border-color:rgba(251,191,36,.55);}
    .panel{border:1px solid var(--line); background:rgba(255,255,255,.05); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow);}
    .controls{display:grid; grid-template-columns:1.6fr 1fr 1fr 1fr; gap:10px; align-items:end;}
    @media (max-width:960px){.controls{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.controls{grid-template-columns:1fr}}
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px 2px;}
    input[type="search"], select{width:100%; padding:11px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.25); color:var(--text); outline:none;}
    input[type="search"]::placeholder{color:rgba(255,255,255,.45)}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; align-items:center;}
    .chip{border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.05); color:var(--muted); padding:7px 10px; border-radius:999px; cursor:pointer; font-size:12px; font-weight:650;}
    .chip:hover{background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.22)}
    .chip.active{background:rgba(125,211,252,.14); border-color:rgba(125,211,252,.32); color:rgba(255,255,255,.92);}
    .meta-row{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-top:12px; border-top:1px solid var(--line); padding-top:12px; color:var(--muted); font-size:13px;}
    .grid{margin-top:16px; display:grid; grid-template-columns:repeat(3,1fr); gap:12px;}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:620px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line); border-radius:var(--radius); overflow:hidden; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04)); box-shadow:var(--shadow); min-height:220px; display:flex; flex-direction:column;}
    .thumb{height:130px; background:rgba(255,255,255,.05); position:relative; overflow:hidden;}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .thumb .fallback{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,.55); font-weight:750; letter-spacing:.5px;
      background: radial-gradient(600px 250px at 10% 10%, rgba(125,211,252,.18), transparent 60%),
                  radial-gradient(500px 250px at 90% 0%, rgba(167,243,208,.14), transparent 60%),
                  rgba(0,0,0,.25);}
    .card-body{padding:12px 12px 10px; display:flex; flex-direction:column; gap:8px; flex:1;}
    .row1{display:flex; gap:10px; align-items:flex-start; justify-content:space-between;}
    .h{font-weight:800; letter-spacing:.2px; font-size:15px; margin:0;}
    .org{font-size:12px; color:var(--muted); margin-top:3px;}
    .desc{color:var(--muted); font-size:13px; margin:0;}
    .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:auto; padding-top:6px;}
    .tag{font-size:11px; color:rgba(255,255,255,.74); border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.04); padding:4px 8px; border-radius:999px;}
    .tag.key{border-color:rgba(125,211,252,.30); background:rgba(125,211,252,.10)}
    .tag.warn{border-color:rgba(251,191,36,.32); background:rgba(251,191,36,.10)}
    .card-actions{display:flex; gap:8px; padding:10px 12px 12px; border-top:1px solid var(--line); align-items:center; justify-content:space-between;}
    .link{display:inline-flex; gap:10px; align-items:center; text-decoration:none; font-weight:750; font-size:13px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.05); flex:1; justify-content:center;}
    .link:hover{background:rgba(255,255,255,.085); border-color:rgba(255,255,255,.22)}
    .icon{width:16px; height:16px; display:inline-block;}
    .star{width:42px; flex:0 0 auto; display:inline-flex; justify-content:center;}
    .star[aria-pressed="true"]{border-color:rgba(251,191,36,.40); background:rgba(251,191,36,.10)}
    footer{margin-top:26px; color:var(--muted2); font-size:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .banner{margin-top:10px; border:1px dashed rgba(251,191,36,.35); background:rgba(251,191,36,.08); padding:10px 12px; border-radius:14px; color:rgba(255,255,255,.85); display:none; white-space:pre-wrap;}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      border:1px solid rgba(255,255,255,.16); border-bottom-color:rgba(255,255,255,.24); background:rgba(0,0,0,.25);
      padding:2px 6px; border-radius:8px; color:rgba(255,255,255,.84); font-size:11px;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">
          CHEMIE mit KI ‚Äì Linkhub
          <span class="badge" id="badgeCount">‚Ä¶</span>
          <span class="badge" id="badgeFavs">‚òÖ ‚Ä¶</span>
          <span class="badge" id="badgeSource">Daten: ‚Ä¶</span>
        </div>
        <div class="subtitle">Kachel√ºbersicht f√ºr Kolleg:innen & Sch√ºler:innen: Padlets, Tools, Quellen ‚Äì filterbar nach <b>Level</b>, <b>Typ</b> und <b>Sprache</b>.</div>
      </div>
      <div class="top-actions">
        <button class="btn primary" id="btnAddHint">‚ûï <span>Erweitern</span> <small>(links.json)</small></button>
        <button class="btn tools" id="btnTools" title="Zeigt nur deine K_CH_TOOLS">‚ö° <span>K_CH_TOOLS</span></button>
        <button class="btn" id="btnDebug">üõ†Ô∏è <span>Debug</span></button>
        <button class="btn" id="btnReset">‚ôªÔ∏è <span>Reset</span></button>
      </div>
    </header>

    <div class="banner" id="banner"></div>

    <section class="panel" aria-label="Filter">
      <div class="controls">
        <div>
          <label for="q">Suche</label>
          <input id="q" type="search" placeholder="z.B. Padlet, MINT, Chemie, assessment, prompt, PH Wien ‚Ä¶" autocomplete="off" />
        </div>
        <div><label for="cat">Kategorie</label><select id="cat"></select></div>
        <div><label for="level">Level</label><select id="level"></select></div>
        <div><label for="lang">Sprache</label><select id="lang"></select></div>
      </div>
      <div class="chips" id="chips" aria-label="Tag-Filter"></div>

      <div class="meta-row">
        <div><span id="resultInfo">‚Äì</span></div>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
          <label style="margin:0; display:flex; gap:8px; align-items:center; cursor:pointer;">
            <input type="checkbox" id="onlyFavs" /> <span>nur Favoriten</span>
          </label>
          <label style="margin:0; display:flex; gap:8px; align-items:center; cursor:pointer;">
            <input type="checkbox" id="onlyPadlets" /> <span>nur Padlets</span>
          </label>
        </div>
      </div>
    </section>

    <main class="grid" id="grid" aria-label="Kacheln"></main>

    <footer>
      <div>¬© deine Sammlung ‚Äì statische HTML-Seite (GitHub Pages).</div>
      <div>Version: <span class="kbd" id="ver">v0.3</span></div>
    </footer>
  </div>

<script>
  const DATA_URL = "data/links.json";
  let DATA = [];

  const state = { q:"", cat:"all", level:"all", lang:"all", chip:"all", onlyFavs:false, onlyPadlets:false };
  const LS_KEY = "chemie-ki-linkhub-favs";
  const favs = new Set(JSON.parse(localStorage.getItem(LS_KEY) || "[]"));

  const $ = (id) => document.getElementById(id);
  const uniq = (arr) => [...new Set(arr)].sort((a,b)=>a.localeCompare(b,'de'));

  function setBanner(msg){
    const b = $("banner");
    if(!msg){ b.style.display="none"; b.textContent=""; return; }
    b.style.display="block";
    b.textContent = msg;
  }

  // safer normalize: no Unicode property escapes (older browsers sometimes fail)
  function normalize(s){
    return (s||"")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");
  }

  function matchesQuery(item, q){
    if(!q) return true;
    const hay = [
      item.title, item.org, item.type, item.category, item.level, item.lang, item.desc,
      ...(item.tags||[])
    ].join(" ‚Ä¢ ");
    return normalize(hay).includes(normalize(q));
  }

  function getAllTags(data){
    const tags = [];
    data.forEach(d => (d.tags||[]).forEach(t => tags.push(t)));
    return uniq(tags);
  }

  function iconSvg(kind){
    const map = {
      "link": `<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M10 13a5 5 0 0 1 0-7l1.5-1.5a5 5 0 0 1 7 7L17 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M14 11a5 5 0 0 1 0 7L12.5 19.5a5 5 0 0 1-7-7L7 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>`,
      "star": `<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 17.3l-5.4 3 1-6.1L3 9.7l6.2-.9L12 3l2.8 5.8 6.2.9-4.6 4.5 1 6.1-5.4-3z"
          stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      </svg>`
    };
    return map[kind] || "";
  }

  function saveFavs(){
    localStorage.setItem(LS_KEY, JSON.stringify([...favs]));
    updateBadges();
  }

  function updateBadges(){
    $("badgeCount").textContent = `${DATA.length} Ressourcen`;
    $("badgeFavs").textContent = `‚òÖ ${favs.size}`;
  }

  function buildSelect(selectEl, values, labelAll){
    selectEl.innerHTML = "";
    const optAll = document.createElement("option");
    optAll.value = "all";
    optAll.textContent = labelAll;
    selectEl.appendChild(optAll);
    values.forEach(v=>{
      const o = document.createElement("option");
      o.value = v;
      o.textContent = v;
      selectEl.appendChild(o);
    });
  }

  function buildChips(tags){
    const chips = $("chips");
    chips.innerHTML = "";

    const make = (text, value) => {
      const c = document.createElement("button");
      c.className = "chip";
      c.type = "button";
      c.textContent = text;
      c.dataset.value = value;
      c.addEventListener("click", ()=>{
        state.chip = value;
        [...chips.querySelectorAll(".chip")].forEach(x=>x.classList.remove("active"));
        c.classList.add("active");
        render();
      });
      return c;
    };

    const all = make("Alle Tags", "all");
    all.classList.add("active");
    chips.appendChild(all);
    tags.forEach(t=> chips.appendChild(make(t, t)));
  }

  function escapeHtml(str){
    return (str ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function escapeAttr(str){ return escapeHtml(str); }

  function cardTemplate(item){
    const hasThumb = !!item.thumb;
    const isFav = favs.has(item.id);

    const tagEls = (item.tags||[]).slice(0,6).map(t=>{
      const cls = ["MINT","STEM","Chemie","Chemistry"].some(k => normalize(t).includes(normalize(k))) ? "tag key" :
                  ["Assessment","Pr√ºfung","Responsible Use","Policies/Ethics"].some(k => normalize(t).includes(normalize(k))) ? "tag warn" : "tag";
      return `<span class="${cls}">${escapeHtml(t)}</span>`;
    }).join("");

    return `
      <article class="card" data-id="${escapeHtml(item.id)}">
        <div class="thumb">
          ${hasThumb ? `<img src="${escapeAttr(item.thumb)}" alt="Vorschaubild: ${escapeAttr(item.title)}" loading="lazy">`
                     : `<div class="fallback">${escapeHtml(item.type || "Ressource")}</div>`}
        </div>
        <div class="card-body">
          <div class="row1">
            <div>
              <h3 class="h">${escapeHtml(item.title || "‚Äî")}</h3>
              <div class="org">${escapeHtml(item.org || "")}</div>
            </div>
            <span class="badge">${escapeHtml(item.type || "‚Äî")}</span>
          </div>
          <p class="desc">${escapeHtml(item.desc || "")}</p>
          <div class="tags">
            <span class="tag">${escapeHtml(item.category || "‚Äî")}</span>
            <span class="tag">${escapeHtml(item.level || "‚Äî")}</span>
            <span class="tag">${escapeHtml(item.lang || "‚Äî")}</span>
            ${tagEls}
          </div>
        </div>
        <div class="card-actions">
          <a class="link" href="${escapeAttr(item.url)}" target="_blank" rel="noopener">${iconSvg("link")} √ñffnen</a>
          <button class="btn star" type="button" aria-pressed="${isFav}" title="Favorit">${iconSvg("star")}</button>
        </div>
      </article>
    `;
  }

  function applyFilters(){
    return DATA.filter(item=>{
      if(state.onlyPadlets && normalize(item.type) !== "padlet") return false;
      if(state.onlyFavs && !favs.has(item.id)) return false;
      if(state.cat !== "all" && item.category !== state.cat) return false;
      if(state.level !== "all" && item.level !== state.level) return false;
      if(state.lang !== "all" && item.lang !== state.lang) return false;
      if(state.chip !== "all" && !(item.tags||[]).includes(state.chip)) return false;
      if(!matchesQuery(item, state.q)) return false;
      return true;
    });
  }

  function render(){
    const grid = $("grid");
    const filtered = applyFilters();
    $("resultInfo").textContent = `${filtered.length} Treffer`;

    grid.innerHTML = filtered.map(cardTemplate).join("");

    grid.querySelectorAll(".card").forEach(card=>{
      const id = card.dataset.id;
      const btn = card.querySelector(".star");
      btn.addEventListener("click", ()=>{
        if(favs.has(id)) favs.delete(id); else favs.add(id);
        btn.setAttribute("aria-pressed", favs.has(id));
        saveFavs();
        if(state.onlyFavs) render();
      });
    });

    // helpful banner if nothing shows
    if(DATA.length > 0 && filtered.length === 0){
      setBanner("Keine Treffer mit den aktuellen Filtern.\n‚Üí Klick 'Reset' oder l√∂sche die Suche.");
    }else if(DATA.length === 0){
      setBanner("Es wurden 0 Eintr√§ge geladen.\n‚Üí Debug klicken (zeigt Lade-Status / Fehler).");
    }else{
      setBanner("");
    }
  }

  async function loadData(){
    $("badgeSource").textContent = "Daten: lade‚Ä¶";
    const res = await fetch(DATA_URL, { cache: "no-store" });
    if(!res.ok) throw new Error(`HTTP ${res.status} beim Laden von ${DATA_URL}`);
    const json = await res.json();
    if(!Array.isArray(json)) throw new Error("links.json muss ein JSON-Array sein (Liste).");
    return json;
  }

  function initControls(){
    const cats = uniq(DATA.map(d=>d.category).filter(Boolean));
    const levels = uniq(DATA.map(d=>d.level).filter(Boolean));
    const langs = uniq(DATA.map(d=>d.lang).filter(Boolean));

    buildSelect($("cat"), cats, "Alle Kategorien");
    buildSelect($("level"), levels, "Alle Level");
    buildSelect($("lang"), langs, "Alle Sprachen");

    $("q").addEventListener("input", (e)=>{ state.q = e.target.value.trim(); render(); });
    $("cat").addEventListener("change", (e)=>{ state.cat = e.target.value; render(); });
    $("level").addEventListener("change", (e)=>{ state.level = e.target.value; render(); });
    $("lang").addEventListener("change", (e)=>{ state.lang = e.target.value; render(); });
    $("onlyFavs").addEventListener("change", (e)=>{ state.onlyFavs = e.target.checked; render(); });
    $("onlyPadlets").addEventListener("change", (e)=>{ state.onlyPadlets = e.target.checked; render(); });

    buildChips(getAllTags(DATA));
  }

  function showDebug(extra=""){
    const lines = [];
    lines.push(`DATA_URL: ${DATA_URL}`);
    lines.push(`Loaded entries: ${DATA.length}`);
    lines.push(`Example entry: ${DATA[0] ? JSON.stringify(DATA[0], null, 2) : "‚Äî"}`);
    if(extra) lines.push("\n" + extra);
    setBanner(lines.join("\n"));
  }

  // show JS errors inside the page (very useful on Pages)
  window.addEventListener("error", (e)=> {
    setBanner(`JavaScript-Fehler:\n${e.message}\n(${e.filename}:${e.lineno}:${e.colno})`);
  });
  window.addEventListener("unhandledrejection", (e)=> {
    setBanner(`Promise-Fehler:\n${e.reason?.message || e.reason}`);
  });

  (async function init(){
    $("ver").textContent = "v0.4";
    try{
      DATA = await loadData();
      $("badgeSource").textContent = `Daten: ${DATA_URL}`;
      updateBadges();
      initControls();
      render();
    }catch(err){
      $("badgeSource").textContent = "Daten: FEHLER";
      DATA = [];
      updateBadges();
      initControls();
      render();
      setBanner(`Konnte ${DATA_URL} nicht laden:\n${err.message}\n\nTest: √ñffne ${location.origin}${location.pathname.replace(/\/[^\/]*$/, "/")}data/links.json`);
    }

    
    $("btnTools").addEventListener("click", ()=>{
      // Set filter to K_CH_TOOLS category and reset other filters
      state.q = "";
      state.cat = "K_CH_TOOLS";
      state.level = "all";
      state.lang = "all";
      state.chip = "all";
      state.onlyFavs = false;
      state.onlyPadlets = false;

      $("q").value = "";
      $("onlyFavs").checked = false;
      $("onlyPadlets").checked = false;

      $("cat").value = "K_CH_TOOLS";
      $("level").value = "all";
      $("lang").value = "all";

      // reset chips UI
      [...$("chips").querySelectorAll(".chip")].forEach(x=>x.classList.remove("active"));
      const first = $("chips").querySelector(".chip"); if(first) first.classList.add("active");

      render();
    });


  $("btnReset").addEventListener("click", ()=>{
      state.q=""; state.cat="all"; state.level="all"; state.lang="all"; state.chip="all";
      state.onlyFavs=false; state.onlyPadlets=false;
      $("q").value=""; $("cat").value="all"; $("level").value="all"; $("lang").value="all";
      $("onlyFavs").checked=false; $("onlyPadlets").checked=false;
      [...$("chips").querySelectorAll(".chip")].forEach(x=>x.classList.remove("active"));
      const first = $("chips").querySelector(".chip"); if(first) first.classList.add("active");
      render();
    });

    $("btnAddHint").addEventListener("click", ()=>{
      alert("Erweitern:\n1) √ñffne data/links.json\n2) Neuen Eintrag als JSON-Objekt hinzuf√ºgen\n3) Optional thumb: assets/thumbs/<id>.webp");
    });

    $("btnDebug").addEventListener("click", ()=>{
      showDebug("Wenn 'Loaded entries' > 0 ist und trotzdem keine Kacheln erscheinen, liegt es an einem JS-Fehler oder Filtern.");
    });
  })();
</script>
</body>
</html>
